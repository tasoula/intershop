<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8"/>
<head>
    <title>Витрина товаров</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.cart-form button').click(function(event) {
            event.preventDefault();

            var itemId = $(this).closest('.item-card').find('a').attr('href').split('/').pop();
            var action = $(this).val();
            var $quantitySpan = $(this).siblings('span');

            $.ajax({
                url: '/catalog/items/' + itemId + '?action=' + action,
                type: 'POST',
                success: function(newQuantity) { // Get the new quantity from the server's response
                    // Update the quantity on the page with the value returned by the server
                    $quantitySpan.text(newQuantity);
                },
                error: function(xhr, status, error) {
                    console.error("Ошибка при изменении количества: " + error);
                    // Show an error message to the user
                    alert("Невозможно добавить больше товаров в корзину.  Превышен остаток."); // Example error message
                }
         });
     });
 });
    </script>
</head>

<body>
<a href="/orders" style="float:right;">
    <b>ЗАКАЗЫ &cudarrr;</b>
</a>
<a href="/cart/items" style="float:right;">
    <b>КОРЗИНА &cudarrr;</b>
</a>
<a href="/catalog/items" style="float:right;">
    <b>ГЛАВНАЯ &cudarrr;</b>
</a>
<div style="width:70%;margin-left:auto;margin-right:auto;">
    <p>
        <img height = "300" th:src="@{/catalog/images/{id}(id = ${item.getId()})}"/>
    </p>
    <p>
        <b th:text="${item.getTitle()}"></b>
        <b th:text="${item.getPrice()}+' руб.'" style="text-align:right;"></b>
    </p>
    <div th:each="paragraph : ${item.getTextParts()}">
        <p th:text="${paragraph}"></p>
    </div>
    <form class="cart-form">
        <button type="button" name="action" value="minus">-</button>
        <span th:text="${item.getCartQuantity()}"></span>
        <button type="button" name="action" value="plus">+</button>
        <button type="button" name="action" value="plus" th:if="${item.getCartQuantity()==0}">В корзину</button>
    </form>
</div>
</body>

</html>
# Витрина интернет-магазина

## Описание

Веб-приложение "Витрина интернет-магазина" разработано на Spring Boot с использованием реактивного стека (Spring WebFlux и Spring Data R2DBC) и предоставляет функциональность для просмотра, добавления в корзину и покупки товаров.

## Технологии

•   **Фреймворк:** Spring Boot (3.5.4)
•   **Язык программирования:** Java 21
•   **Сборка:** Gradle
•   **База данных:** PostgreSQL
•   **Шаблонизатор:** Thymeleaf
•   **Веб-фреймворк:** Spring WebFlux (Reactive Web)
•   **Доступ к данным:** Spring Data R2DBC (Reactive Relational Database Connectivity) 
•   **Тестирование:** JUnit 5, Spring TestContext Framework, Spring Boot Test, Testcontainers, Reactor Test
•   **Сервлет-контейнер:** Netty (Embedded Reactive Server)
•   **Контейнеризация:** Docker

## Необходимые условия

Для работы приложения необходимо установить следующее программное обеспечение:

•   Java 21 JDK
•   Gradle
•   Экземпляр PostgreSQL
•   Docker
•   Docker Compose

## Функциональность

Приложение предоставляет следующий основной функционал:

•   **Каталог товаров:**
•   Отображение списка товаров с изображениями, названиями, ценами и кнопками добавления в корзину.
•   Пагинация результатов (варианты: 10, 20, 50, 100 товаров на странице).
•   Поиск товаров по названию и описанию.
•   Фильтрация товаров по цене и сортировка по алфавиту.
•   **Страница товара:**
•   Детальная информация о выбранном товаре (название, изображение, описание, цена).
•   Возможность добавления и удаления товара из корзины.
•   Изменение количества товара в корзине непосредственно на странице товара.
•   **Корзина:**
•   Отображение списка выбранных товаров с указанием количества, цены и общей суммы.
•   Возможность удаления товаров из корзины и изменения их количества.
•   Кнопка "Оформить заказ".
•   **История заказов:**
•   Список всех оформленных заказов пользователя с указанием даты, номера заказа и общей суммы.
•   **Страница заказа (детализация):**
•   Список товаров, входящих в конкретный заказ (изображение, название, цена, количество).
•   **Оформление заказа:**
•   Эмуляция процесса оформления заказа (без реальной интеграции с платежными системами).
•   После "оформления" заказа, отображается страница подтверждения с деталями заказа.
•   **Добавление нового товара (только для администратора):**
•   Веб-интерфейс для загрузки информации о новых товарах на витрину (включая загрузку изображений, указание названия, описания и цены).  *Примечание: Этот функционал доступен только для пользователей с ролью администратора.*

## Настройка и конфигурация:

1.  **Настройка базы данных:**

    •   Создайте базу данных PostgreSQL для разработки.
    •   Схема создается автоматически с помощью Spring Data R2BC.
    •   (Опционально) Для первоначальной загрузки данных можно использовать дамп `db-backup/backup_blog_db.sql`.
    
2.  **Конфигурация приложения:**

    Отредактируйте файл `src/main/resources/application.yml` и настройте следующие параметры:

•   **Директория для загрузки изображений:**

```yaml
    blog.image.upload.dir: /path/to/your/upload/directory
```
Убедитесь, что указанная директория существует, и у приложения есть права на запись в нее. 
Изображения для первоначальной загрузки данных в таблицу товаров находятся в папке images в корне проекта.

•   Рабочая база данных:
```yaml
     spring:
      datasource:
       url: r2dbc:postgresql://localhost:5432/your_database_name
       username: your_username
       password: your_password
```

•  Тестовая база данных (для тестового профиля):

```yaml
     datasource:
      name: your_test_database_name
      username: your_test_username
      password: your_test_password
```

## Сборка и запуск

### 1. В среде разработки

1.  Импортируйте проект в вашу IDE (IntelliJ IDEA, Eclipse, и т.д.).
2.  Убедитесь, что у вас установлена Java 21 и Gradle.
3.  Настройте подключение к базе данных PostgreSQL (см. `application.yml` или `application.properties`).
4.  Выполните сборку и запуск приложения, используя возможности вашей интегрированной среды разработки (IDE).
5.  Т.к. для интеграционного тестирования используется Tescontainers, то перед запуском тестов убедитесь, что Docker установлен и запущен.
  
### 2. Локально (из командной строки)

Сборка JAR:  
```bash
./gradlew bootRun
```
Запуск тестов (убедитесь, что Docker установлен и запущен):    
```bash 
./gradlew :test
```

### 3. Сборка и запуск с использованием Docker

**1. Настройка окружения:**

•   Установите переменные окружения  для подключения к базе данных: INTERSHOP_DB_NAME, INTERSHOP_DB_USERNAME, INTERSHOP_DB_PASSWORD, UPLOAD_IMAGES_DIR

**2. Сборка и запуск Docker-контейнера:**

•   Соберите проект с помощью Gradle:
```bash
./gradlew build
```
•   Запустите Docker Compose:
```bash
docker-compose up --build
```

## Доступ к приложению

После запуска приложения, веб-интерфейс будет доступен по адресу:

•  http://localhost:8080/catalog или http://localhost:8080/catalog/items (просмотр каталога)
•  http://localhost:8080/catalog/products/new (добавление новых товаров)

